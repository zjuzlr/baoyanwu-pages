{% extends "base.html" %}

{% block title %}æ¯æ—¥æŠ½ç­¾ - ä¿ç ”åè§£å‹é©¿ç«™{% endblock %}

{% block head_extra %}
<style>
    /* çƒŸèŠ±å®¹å™¨ */
    #fireworks-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 3000;
        display: none;
    }

    /* ç­¾æ–‡ä¸åŒç­‰çº§èƒŒæ™¯è‰² */
    .fortune-box {
        margin-top:30px;
        padding:20px;
        border-radius:12px;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        font-size:24px;
        font-weight:bold;
    }
    .big { background-color: #ffe066; }     /* é‡‘é»„è‰² - å¤§å‰ */
    .small { background-color: #d4edda; }   /* ç»¿è‰² - å°å‰ */
    .bad { background-color: #f8d7da; }     /* ç²‰çº¢ - å°å‡¶ */
    .normal { background-color: #d1ecf1; }  /* è“è‰² - å¹³è¿ */
    .other { background-color: #f0f0f0; }   /* ç°è‰² - å…¶ä»– */
</style>
{% endblock %}

{% block content %}
<div style="max-width:600px; margin:80px auto; padding:30px; background:white; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); text-align:center;">
    <h1 style="font-size:28px; margin-bottom:20px;">ğŸ”® æ¯æ—¥æŠ½ç­¾</h1>
    <p style="font-size:20px; color:#555;">ä»Šå¤©æ˜¯ {{ today }}</p>

    <!-- ç­¾æ–‡å±•ç¤ºï¼ŒåŠ¨æ€åŠ  class -->
    <div class="fortune-box {{ fortune_level }}">
        {{ fortune }}
    </div>

    <!-- TIPS æç¤ºï¼ˆä»…å°å‰/å°å‡¶ï¼‰ -->
    {% if tips %}
        <div style="margin-top:20px; font-size:16px; color:#555; background:#fefefe; padding:10px; border-left:4px solid #5cb85c; border-radius:6px;">
            {{ tips }}
        </div>
    {% endif %}

    <!-- è®¸æ„¿æŒ‰é’®ï¼ˆä»…å¤§å‰ï¼‰ -->
    {% if is_big_fortune %}
        <button onclick="openWish()" style="margin-top:25px; padding:10px 20px; font-size:16px; background:#ff9800; color:white; border:none; border-radius:6px; cursor:pointer;">
            ğŸ™ è®¸ä¸‹æˆ‘çš„ä¿ç ”æ„¿æœ›
        </button>
    {% endif %}

    <p style="margin-top:30px; font-size:16px; color:#888;">æ˜å¤©å†æ¥çœ‹çœ‹æ–°çš„è¿åŠ¿å§ âœ¨</p>
</div>

<!-- çƒŸèŠ±å®¹å™¨ -->
<div id="fireworks-container"></div>

<!-- å¼•å…¥ fireworks-js -->
<script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.1.0/dist/index.umd.min.js"></script>

<script>
    const isBigFortune = {{ "true" if is_big_fortune else "false" }};

    // çƒŸèŠ±æ•ˆæœ (ä»…å¤§å‰)
    if (isBigFortune) {
        const container = document.getElementById('fireworks-container');
        container.style.display = 'block';
        const fireworks = new Fireworks.default(container, {
            speed: 2,
            acceleration: 1.05,
            friction: 0.95,
            gravity: 1.5,
            particles: 100,
            trace: 5,
            explosion: 5,
            autoresize: true
        });
        fireworks.start();

        // 3ç§’åè‡ªåŠ¨åœæ­¢çƒŸèŠ±
        setTimeout(() => {
            fireworks.stop();
            container.style.display = 'none';
        }, 3000);
    }

    // è®¸æ„¿å¼¹çª—
    function openWish() {
        document.getElementById("wishModal").style.display = "block";
    }

    function closeWish() {
        document.getElementById("wishModal").style.display = "none";
    }

    function submitWish() {
        const wish = document.getElementById("wishInput").value.trim();
        if (!wish) {
            alert("è¯·è¾“å…¥ä½ çš„æ„¿æœ›å“¦~");
            return;
        }

        alert("âœ¨ æ„¿ä½ å¿ƒæ„¿æˆçœŸï¼š\n" + wish);
        closeWish();
    }
</script>

<!-- è®¸æ„¿å¼¹çª— -->
<div id="wishModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:4000;">
    <div style="background:white; max-width:400px; margin:100px auto; padding:30px; border-radius:10px; text-align:center; position:relative;">
        <h3 style="margin-bottom:15px;">ğŸ¯ è®¸ä¸‹ä¸€ä¸ªæ„¿æœ›</h3>
        <input type="text" id="wishInput" placeholder="å¸Œæœ›æˆ‘é¡ºåˆ©é€šè¿‡å¤è¯•..." style="width:100%; padding:10px; font-size:16px; margin-bottom:15px;">
        <br>
        <button onclick="submitWish()" style="padding:10px 20px; background:#4CAF50; color:white; border:none; border-radius:6px; cursor:pointer;">ğŸ æäº¤æ„¿æœ›</button>
        <button onclick="closeWish()" style="padding:10px 20px; margin-left:10px; background:#ccc; border:none; border-radius:6px; cursor:pointer;">å–æ¶ˆ</button>
    </div>
</div>

{% endblock %}
